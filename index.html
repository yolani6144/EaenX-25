<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EarnX 25</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #4f8cff;
      --secondary: #fff;
      --bg: #f6f8fb;
      --text: #222;
      --muted: #888;
      --accent: #ff8c00;
      --card: #fff;
      --card-shadow: 0 4px 24px 0 rgba(79,140,255,0.08);
      --gradient: linear-gradient(90deg, #4f8cff 0%, #ff6bcb 100%);
      --gradient2: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      --gradient3: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
    }
    body {
      margin: 0; padding: 0; background: var(--bg); color: var(--text);
      font-family: 'Segoe UI', 'Roboto', sans-serif;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }
    .container {
      width: 100%; max-width: 420px; background: var(--bg);
      border-radius: 22px; box-shadow: 0 8px 32px 0 rgba(79,140,255,0.10);
      overflow: hidden; min-height: 650px;
      display: flex; flex-direction: column;
      border: 1.5px solid #e3e8f0;
    }
    main { flex: 1; padding: 22px; padding-bottom: 90px; }
    .view { display: none; }
    .view.active { display: block; animation: fadeIn 0.4s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .notice-bar {
      background: linear-gradient(90deg, #ff6bcb 0%, #4f8cff 100%);
      color: #fff;
      border-radius: 12px;
      padding: 10px 16px;
      margin-bottom: 16px;
      font-size: 15px;
      font-weight: 600;
      box-shadow: 0 2px 8px #4f8cff22;
      display: flex; align-items: center; gap: 8px;
    }
    .notice-bar i { font-size: 18px; }
    .user-header-card {
      background: var(--card); border-radius: 18px; padding: 18px; margin-bottom: 22px;
      display: flex; align-items: center; box-shadow: var(--card-shadow);
    }
    .user-avatar {
      width: 54px; height: 54px; border-radius: 50%; margin-right: 16px;
      background: var(--gradient); color: #fff;
      display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 26px;
      box-shadow: 0 2px 8px #4f8cff33;
      overflow: hidden;
    }
    .user-info .username { font-size: 19px; font-weight: 700; }
    .user-info .title { font-size: 14px; color: #888; }
    .balance-card {
      background: var(--gradient2);
      border-radius: 18px; padding: 22px; text-align: center; margin-bottom: 22px;
      box-shadow: 0 2px 12px #43e97b22;
      color: #222;
    }
    .balance-card .label { font-size: 15px; opacity: 0.8; }
    .balance-card .balance-value { font-size: 34px; font-weight: 800; margin: 0; color: #222;}
    .balance-card .points-value { font-size: 15px; font-weight: 600; color: #ff8c00;}
    .section-title { font-size: 18px; font-weight: 700; margin-bottom: 13px; border-left: 4px solid #4f8cff; padding-left: 8px; letter-spacing: 1px;}
    .task-card, .list-item {
      background: var(--card); border-radius: 14px; padding: 16px; margin-bottom: 13px;
      display: flex; align-items: center; cursor: pointer; border: 1px solid #e3e8f0;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
      box-shadow: var(--card-shadow);
    }
    .task-card:hover { background: #f0f6ff; transform: translateY(-2px) scale(1.01);}
    .task-icon {
      font-size: 24px;
      background: var(--gradient3);
      color: #fff;
      border-radius: 10px;
      padding: 10px;
      margin-right: 16px;
      box-shadow: 0 2px 8px #fa709a22;
    }
    .task-details h3 { margin: 0; font-size: 15px; font-weight: 600; }
    .task-details p { margin: 2px 0 0; font-size: 12px; color: var(--muted);}
    .task-arrow { margin-left: auto; font-size: 16px; color: var(--muted);}
    .footer-nav {
      position: fixed; bottom: 0; left: 0; right: 0; width: 100%; max-width: 400px; margin: 0 auto;
      display: flex; justify-content: space-around; background: #fff;
      padding: 12px 0; border-top: 1px solid #e3e8f0; z-index: 10;
      box-shadow: 0 -2px 12px #4f8cff11;
    }
    .nav-button {
      display: flex; flex-direction: column; align-items: center; color: var(--muted);
      background: none; border: none; font-size: 12px; cursor: pointer; padding: 5px 10px;
      transition: color 0.2s, transform 0.2s;
    }
    .nav-button .icon { font-size: 20px; margin-bottom: 3px; }
    .nav-button.active {
      color: #4f8cff;
      transform: scale(1.1);
      font-weight: bold;
    }
    .powered-by {
      text-align: center;
      color: #888;
      font-size: 14px;
      margin-top: 40px;
      margin-bottom: 10px;
      letter-spacing: 0.5px;
    }
    .connect-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 1px 4px #4f8cff11;
      padding: 14px 16px;
      margin-bottom: 13px;
      display: flex; align-items: center; justify-content: space-between;
      font-size: 15px;
      font-weight: 600;
      gap: 10px;
    }
    .connect-left {
      display: flex; align-items: center; gap: 8px;
      color: #2563eb;
      font-weight: 600;
    }
    .connect-card .fa-link {
      color: #4f8cff;
      font-size: 18px;
    }
    .connect-btn {
      background: linear-gradient(90deg, #4f8cff 0%, #ff6bcb 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 18px;
      font-size: 15px;
      font-weight: 600;
      text-decoration: none;
      display: flex; align-items: center; gap: 7px;
      box-shadow: 0 2px 8px #4f8cff22;
      transition: background 0.2s, transform 0.2s;
    }
    .connect-btn:hover {
      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      color: #fff;
      transform: scale(1.04);
      text-decoration: none;
    }
    .connect-btn .fa-telegram {
      font-size: 17px;
    }
    .withdraw-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px #4f8cff11;
      padding: 28px 22px 22px 22px;
      max-width: 370px;
      margin: 30px auto 0 auto;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .withdraw-title {
      font-size: 20px;
      font-weight: 700;
      color: #222;
      border-left: 4px solid #4f8cff;
      padding-left: 8px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .withdraw-label {
      font-size: 15px;
      color: #222;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .withdraw-input {
      padding: 12px 14px;
      border-radius: 8px;
      border: 1.5px solid #e3e8f0;
      font-size: 15px;
      margin-bottom: 14px;
      background: #f6f8fb;
      outline: none;
      transition: border 0.2s;
    }
    .withdraw-input:focus {
      border: 1.5px solid #4f8cff;
    }
    .withdraw-info {
      font-size: 14px;
      color: #888;
      margin-bottom: 18px;
    }
    .withdraw-btn {
      width: 100%;
      padding: 15px 0;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
      color: #222;
      cursor: pointer;
      box-shadow: 0 2px 8px #fa709a22;
      transition: background 0.2s, transform 0.2s;
      letter-spacing: 1px;
    }
    .withdraw-btn:disabled {
      background: linear-gradient(90deg, #bdbdbd 0%, #e0e0e0 100%) !important;
      color: #888 !important;
      cursor: not-allowed;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .more-option-btn {
      width: 100%;
      margin-top: 10px;
      padding: 12px 0;
      border-radius: 10px;
      border: 1.5px solid #e3e8f0;
      background: #f6f8fb;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .more-option-btn:hover {
      background: #e0e7ff;
    }
    .page-card {
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 2px 16px #4f8cff11;
      padding: 24px 18px 18px 18px;
      margin-bottom: 22px;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
    }
    .page-title {
      font-size: 19px;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 18px;
      border-left: 4px solid #4f8cff;
      padding-left: 8px;
      display: flex; align-items: center; gap: 8px;
    }
    .mini-card {
      background: #f6f8fb;
      border-radius: 14px;
      box-shadow: 0 1px 4px #4f8cff11;
      padding: 14px 12px;
      margin-bottom: 14px;
      display: flex; align-items: center;
      transition: background 0.2s, transform 0.2s;
      cursor: default;
      gap: 12px;
    }
    .mini-card:last-child { margin-bottom: 0; }
    .mini-card .icon {
      font-size: 18px;
      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
      color: #fff;
      border-radius: 8px;
      padding: 7px;
      margin-right: 8px;
      box-shadow: 0 2px 8px #43e97b22;
    }
    .mini-card .referral-avatar, .mini-card .leaderboard-avatar {
      width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(90deg, #4f8cff 0%, #ff6bcb 100%);
      color: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; margin-right: 12px;
    }
    .mini-card .referral-info, .mini-card .leaderboard-info { flex: 1; }
    .mini-card .referral-name, .mini-card .leaderboard-name { font-weight: 600; }
    .mini-card .referral-date, .mini-card .leaderboard-score, .mini-card .history-date {
      font-size: 12px; color: #888;
    }
    .mini-card .referral-score, .mini-card .leaderboard-score {
      color: #ff8c00; font-weight: 600; margin-left: auto;
    }
    .mini-card .history-name { font-weight: 600; }
    .mini-card .history-date { color: #888; font-size: 12px;}
    .copy-btn {
      background: #43e97b;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 3px 10px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      margin-left: 6px;
      transition: background 0.2s;
    }
    .copy-btn:hover { background: #fa709a;}
    .ref-link-box {
      display: flex; align-items: center; gap: 8px; margin-bottom: 10px;
      background: #f6f8fb; border-radius: 8px; padding: 8px 10px;
    }
    .leaderboard-rank {
      font-weight: bold; color: #4f8cff; width: 28px;
    }
    @media (max-width: 500px) {
      .container { border-radius: 0; min-height: 100vh;}
      main { padding: 12px; padding-bottom: 90px;}
      .withdraw-card { padding: 18px 6px 18px 6px; }
      .page-card { padding: 14px 4px 10px 4px;}
    }
    #ad-modal {
      display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:999;justify-content:center;align-items:center;
    }
    #ad-modal .ad-modal-content {
      background:#fff;border-radius:16px;max-width:350px;width:95%;padding:18px 12px;position:relative;
    }
    #ad-modal .close-btn {
      position:absolute;top:8px;right:12px;background:none;border:none;font-size:22px;color:#888;cursor:pointer;
    }
    /* More Withdraw Modal */
    #more-withdraw-modal {
      display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999;background:#0008;justify-content:center;align-items:center;
    }
    #more-withdraw-modal .modal-content {
      background:#fff;border-radius:16px;max-width:350px;width:95%;padding:22px 16px;position:relative;
    }
  </style>
</head>
<body>
  <div class="container">
    <main>
      <div class="notice-bar" id="notice-bar">
        <i class="fa-solid fa-bell"></i>
        <span id="notice-text">Welcome to Nobin's EarnX! 🎉</span>
      </div>
      <!-- Home View -->
      <div id="home-view" class="view active">
        <div class="user-header-card">
          <div class="user-avatar" id="profile-pic">U</div>
          <div class="user-info">
            <div class="username" id="username">Demo User</div>
            <div class="title">Welcome to EarnX 25!</div>
          </div>
        </div>
        <div class="balance-card">
          <div class="label">Total Balance</div>
          <div class="balance-value" id="balance-value">$0.00</div>
          <div class="points-value"><i class="fa-solid fa-coins"></i> <span id="points-value">0</span> Points</div>
        </div>
        <div class="section-title">Quick Actions</div>
        <div class="task-card" onclick="showView('tasks-view')">
          <div class="task-icon"><i class="fa-solid fa-list-check"></i></div>
          <div class="task-details"><h3>View Tasks</h3><p>Watch ads & complete tasks to earn points.</p></div>
          <div class="task-arrow"><i class="fa-solid fa-chevron-right"></i></div>
        </div>
        <div class="task-card" onclick="showView('withdraw-view')">
          <div class="task-icon"><i class="fa-solid fa-wallet"></i></div>
          <div class="task-details"><h3>Withdraw</h3><p>Request to withdraw your balance.</p></div>
          <div class="task-arrow"><i class="fa-solid fa-chevron-right"></i></div>
        </div>
        <div class="connect-card" style="margin-top:18px;">
          <div class="connect-left">
            <i class="fa-solid fa-link"></i>
            <span>Connect with us:</span>
          </div>
          <a href="#" id="connect-link" target="_blank" class="connect-btn">
            <i class="fa-brands fa-telegram"></i> Chat Now
          </a>
        </div>
        <div class="powered-by">
          Powered by <b>nobin</b> | &copy; 2024 EarnX 25
        </div>
      </div>
      <!-- Tasks View -->
      <div id="tasks-view" class="view">
        <div class="page-card">
          <div class="page-title"><i class="fa-solid fa-list-check"></i> Earning Tasks</div>
          <div class="task-card" onclick="showAdModal()">
            <div class="task-icon"><i class="fa-solid fa-rectangle-ad"></i></div>
            <div class="task-details"><h3>Watch Ad</h3><p>Watch a short ad to earn <span id="ad-point-show">1</span> point(s).</p></div>
            <div class="task-arrow"><i class="fa-solid fa-play"></i></div>
          </div>
          <div class="task-card" onclick="earnPoints('offer')">
            <div class="task-icon"><i class="fa-solid fa-gift"></i></div>
            <div class="task-details"><h3>Complete Offer</h3><p>Complete an offer to earn 5 points.</p></div>
            <div class="task-arrow"><i class="fa-solid fa-play"></i></div>
          </div>
          <div class="task-card" onclick="showView('referral-view')">
            <div class="task-icon"><i class="fa-solid fa-user-plus"></i></div>
            <div class="task-details"><h3>Referral</h3><p>Invite friends & earn bonus points.</p></div>
            <div class="task-arrow"><i class="fa-solid fa-chevron-right"></i></div>
          </div>
        </div>
      </div>
      <!-- Ad Modal -->
      <div id="ad-modal">
        <div class="ad-modal-content">
          <button class="close-btn" onclick="closeAdModal()">&times;</button>
          <div id="monetag-ad-slot"></div>
        </div>
      </div>
      <!-- Referral View -->
      <div id="referral-view" class="view">
        <div class="page-card">
          <div class="page-title"><i class="fa-solid fa-user-plus"></i> Referral</div>
          <div class="ref-link-box">
            <span id="ref-link2"></span>
            <button class="copy-btn" onclick="copyRef()">Copy</button>
          </div>
          <div style="font-size:13px; color:#888; margin-bottom:14px;">
            Share your referral link. For every friend who joins, you get <b>2 points!</b>
          </div>
          <div class="page-title" style="font-size:16px;margin-bottom:10px;"><i class="fa-solid fa-users"></i> Your Referrals</div>
          <div id="referral-list"></div>
        </div>
      </div>
      <!-- Withdraw View -->
      <div id="withdraw-view" class="view">
        <div class="withdraw-card">
          <div class="withdraw-title" style="display:flex;align-items:center;gap:8px;">
            <i class="fa-solid fa-wallet" style="color:#4f8cff;font-size:22px;"></i>
            Withdraw
          </div>
          <div class="withdraw-label">Enter your USDT (BEP20) address</div>
          <input type="text" id="usdt-address" class="withdraw-input" placeholder="e.g. 0x1234...abcd" />
          <div class="withdraw-info">
            Minimum withdraw: <b>$5.00</b><br>
            Your balance: <span id="withdraw-balance">$0.00</span>
          </div>
          <button class="withdraw-btn" id="withdraw-btn" onclick="withdrawRequest()">REQUEST WITHDRAW</button>
          <!-- More Option Button -->
          <button class="more-option-btn" onclick="showMoreWithdrawOptions()">
            <i class="fa-solid fa-ellipsis"></i> More Option
          </button>
        </div>
        <div class="connect-card" style="margin-top:18px;">
          <div class="connect-left">
            <i class="fa-solid fa-link"></i>
            <span>Connect with us:</span>
          </div>
          <a href="#" id="connect-link" target="_blank" class="connect-btn">
            <i class="fa-brands fa-telegram"></i> Chat Now
          </a>
        </div>
        <div class="powered-by">
          Powered by <b>nobin</b> | &copy; 2024 EarnX 25
        </div>
      </div>
      <!-- More Withdraw Option Modal -->
      <div id="more-withdraw-modal">
        <div class="modal-content">
          <button onclick="closeMoreWithdrawModal()" style="position:absolute;top:8px;right:12px;background:none;border:none;font-size:22px;color:#888;cursor:pointer;">&times;</button>
          <div style="font-size:18px;font-weight:700;margin-bottom:18px;text-align:center;">
            <i class="fa-solid fa-money-bill-transfer" style="color:#4f8cff;"></i> More Withdraw Option
          </div>
          <div>
            <button id="bkash-btn" onclick="showBkashForm()" style="width:100%;margin-bottom:12px;padding:12px 0;border-radius:8px;border:1.5px solid #e3e8f0;background:#f6f8fb;font-weight:600;font-size:15px;cursor:pointer;">
              Bkash Withdraw
            </button>
            <button id="nagad-btn" onclick="showNagadForm()" style="width:100%;padding:12px 0;border-radius:8px;border:1.5px solid #e3e8f0;background:#f6f8fb;font-weight:600;font-size:15px;cursor:pointer;">
              Nagad Withdraw
            </button>
          </div>
          <div id="more-withdraw-form" style="margin-top:18px;"></div>
        </div>
      </div>
      <!-- Leaderboard View -->
      <div id="leaderboard-view" class="view">
        <div class="page-card">
          <div class="page-title"><i class="fa-solid fa-trophy"></i> Top Earners</div>
          <div id="leaderboard-list"></div>
        </div>
      </div>
      <!-- History View -->
      <div id="history-view" class="view">
        <div class="page-card">
          <div class="page-title"><i class="fa-solid fa-clock-rotate-left"></i> Recent Activity</div>
          <div id="history-list"></div>
        </div>
      </div>
    </main>
    <nav class="footer-nav">
      <button class="nav-button active" onclick="showView('home-view')"><i class="icon fa-solid fa-house"></i>Home</button>
      <button class="nav-button" onclick="showView('tasks-view')"><i class="icon fa-solid fa-list-check"></i>Tasks</button>
      <button class="nav-button" onclick="showView('referral-view')"><i class="icon fa-solid fa-user-plus"></i>Referral</button>
      <button class="nav-button" onclick="showView('leaderboard-view')"><i class="icon fa-solid fa-trophy"></i>Leaders</button>
      <button class="nav-button" onclick="showView('history-view')"><i class="icon fa-solid fa-clock-rotate-left"></i>History</button>
    </nav>
  </div>
  <script>
    if(window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.expand();
      Telegram.WebApp.ready();
    }

    const firebaseConfig = {
      apiKey: "AIzaSyCB4GocXMbka1e8NSEiJnsEkKm39_t6KRE",
      authDomain: "earnx25-admin.firebaseapp.com",
      projectId: "earnx25-admin",
      storageBucket: "earnx25-admin.appspot.com",
      messagingSenderId: "248014987232",
      appId: "1:248014987232:web:f5e0fc0ed57c3a36009585"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = { id: 101, name: "Demo User" };
    let refBy = null;
    let ratePerPoint = 0.05;

    if(window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
      let tgUser = Telegram.WebApp.initDataUnsafe.user;
      currentUser = {
        id: tgUser.id,
        name: tgUser.first_name + (tgUser.last_name ? ' ' + tgUser.last_name : ''),
        username: tgUser.username || null
      };
      document.getElementById('username').textContent = currentUser.name;

      if(currentUser.username) {
        document.getElementById('profile-pic').innerHTML = `<img src="https://t.me/i/userpic/320/${currentUser.username}.jpg" style="width:54px;height:54px;border-radius:50%;object-fit:cover;display:block;" onerror="this.style.display='none';this.parentNode.textContent='${tgUser.first_name ? tgUser.first_name[0].toUpperCase() : 'U'}';">`;
      } else {
        document.getElementById('profile-pic').textContent = tgUser.first_name ? tgUser.first_name[0].toUpperCase() : 'U';
      }
    }

    db.ref('users/' + currentUser.id).once('value').then(function(snapshot) {
      if(!snapshot.exists()) {
        let userData = {
          id: currentUser.id,
          name: currentUser.name,
          points: 0,
          balance: 0,
          status: "active",
          refBy: refBy || null
        };
        db.ref('users/' + currentUser.id).set(userData);
        if(refBy) {
          db.ref('users/' + refBy + '/referrals').once('value').then(function(snap) {
            let arr = snap.val() || [];
            if(!arr.includes(currentUser.id)) arr.push(currentUser.id);
            db.ref('users/' + refBy + '/referrals').set(arr);
          });
          db.ref('users/' + refBy).once('value').then(function(snap) {
            let refUser = snap.val();
            if(refUser) {
              let newPoints = (refUser.points || 0) + 2;
              let newBalance = newPoints * ratePerPoint;
              db.ref('users/' + refBy).update({ points: newPoints, balance: newBalance });
            }
          });
        }
      }
    });

    // ---- REFERRAL LINK FIX ----
    let botUsername = "EarnX25_bot";
    let referLink = `https://t.me/${botUsername}?start=${currentUser.id}`;
    document.getElementById('ref-link2').textContent = referLink;
    // ---------------------------

    let notice = localStorage.getItem('notice') || "Welcome to Nobin's EarnX! 🎉";
    let connectLink = localStorage.getItem('connectLink') || "https://t.me/nobin_support";
    document.getElementById('notice-text').textContent = notice;
    document.getElementById('connect-link').href = connectLink;

    let adPoint = parseInt(localStorage.getItem('adPoint') || '1');
    document.getElementById('ad-point-show').textContent = adPoint;

    let points = parseInt(localStorage.getItem('points') || '0');
    let balance = parseFloat(localStorage.getItem('balance') || '0');
    let withdrawPending = localStorage.getItem('withdrawPending') === 'true';

    db.ref('users/' + currentUser.id).on('value', function(snapshot) {
      let data = snapshot.val();
      if (data) {
        points = data.points || 0;
        balance = data.balance || 0;
        localStorage.setItem('points', points);
        localStorage.setItem('balance', balance);
        document.getElementById('points-value').textContent = points;
        document.getElementById('balance-value').textContent = `$${balance.toFixed(2)}`;
        document.getElementById('withdraw-balance').textContent = `$${balance.toFixed(2)}`;
      }
    });

    function showView(id) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
      let btns = document.querySelectorAll('.nav-button');
      if(id === 'home-view') btns[0].classList.add('active');
      if(id === 'tasks-view') btns[1].classList.add('active');
      if(id === 'referral-view') btns[2].classList.add('active');
      if(id === 'leaderboard-view') btns[3].classList.add('active');
      if(id === 'history-view') btns[4].classList.add('active');
      if(id === 'withdraw-view') btns.forEach(b=>b.classList.remove('active'));
      if(id === 'withdraw-view') document.querySelector('.nav-button.active')?.classList.remove('active');
      if(id === 'withdraw-view') {
        withdrawPending = localStorage.getItem('withdrawPending') === 'true';
        document.getElementById('withdraw-balance').textContent = `$${balance.toFixed(2)}`;
        let btn = document.getElementById('withdraw-btn');
        if(withdrawPending) {
          btn.textContent = "PENDING";
          btn.disabled = true;
        } else {
          btn.textContent = "REQUEST WITHDRAW";
          btn.disabled = false;
        }
      }
      if(id === 'tasks-view') {
        adPoint = parseInt(localStorage.getItem('adPoint') || '1');
        document.getElementById('ad-point-show').textContent = adPoint;
      }
      if(id === 'history-view') {
        loadHistory();
      }
      if(id === 'leaderboard-view') {
        loadLeaderboard();
      }
      if(id === 'referral-view') {
        loadReferrals();
      }
    }

    function earnPoints(type) {
      adPoint = parseInt(localStorage.getItem('adPoint') || '1');
      let earn = 0;
      if(type === 'ad') earn = adPoint;
      if(type === 'offer') {
        alert('Coming Soon!');
        return;
      }
      points += earn;
      balance = points * ratePerPoint;
      localStorage.setItem('points', points);
      localStorage.setItem('balance', balance);
      db.ref('users/' + currentUser.id).update({
        points: points,
        balance: balance
      });
      document.getElementById('points-value').textContent = points;
      document.getElementById('balance-value').textContent = `$${balance.toFixed(2)}`;
      document.getElementById('withdraw-balance').textContent = `$${balance.toFixed(2)}`;
      let now = new Date();
      let time = now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');
      let msg = `<div class="mini-card">
        <div class="icon"><i class="fa-solid fa-plus-circle"></i></div>
        <div>
          <div class="history-name">+${earn} Point${earn>1?'s':''} from ${type==='ad'?'Ad':'Offer'}</div>
          <div class="history-date">${time}</div>
        </div>
      </div>`;
      let historyArr = JSON.parse(localStorage.getItem('historyArr') || '[]');
      historyArr.unshift(msg);
      localStorage.setItem('historyArr', JSON.stringify(historyArr));
    }

    function withdrawRequest() {
      let address = document.getElementById('usdt-address').value.trim();
      let btn = document.getElementById('withdraw-btn');
      if (!address) {
        alert('Please enter your USDT (BEP20) address!');
        return;
      }
      if (balance < 5) {
        alert('Minimum withdraw is $5.00');
        return;
      }
      let withdraws = JSON.parse(localStorage.getItem('withdrawRequests') || '[]');
      withdraws.push({
        id: Date.now().toString(),
        userId: currentUser.id,
        name: currentUser.name,
        address: address,
        amount: balance,
        status: "pending"
      });
      localStorage.setItem('withdrawRequests', JSON.stringify(withdraws));
      document.getElementById('usdt-address').value = '';
      btn.textContent = "PENDING";
      btn.disabled = true;
      withdrawPending = true;
      localStorage.setItem('withdrawPending', 'true');
      let now = new Date();
      let time = now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');
      let msg = `<div class="mini-card">
        <div class="icon"><i class="fa-solid fa-paper-plane"></i></div>
        <div>
          <div class="history-name">Withdraw request: $${balance.toFixed(2)}</div>
          <div class="history-date">${time}</div>
        </div>
      </div>`;
      let historyArr = JSON.parse(localStorage.getItem('historyArr') || '[]');
      historyArr.unshift(msg);
      localStorage.setItem('historyArr', JSON.stringify(historyArr));
      alert('Withdraw request sent!\n\nAddress: ' + address + '\nAmount: $' + balance.toFixed(2));
    }

    // More Withdraw Option Modal Functions
    function showMoreWithdrawOptions() {
      document.getElementById('more-withdraw-modal').style.display = 'flex';
      document.getElementById('more-withdraw-form').innerHTML = '';
      // Disable buttons if pending
      let pending = localStorage.getItem('withdrawPending') === 'true';
      document.getElementById('bkash-btn').disabled = pending;
      document.getElementById('nagad-btn').disabled = pending;
      if(pending) {
        document.getElementById('bkash-btn').textContent = "PENDING";
        document.getElementById('nagad-btn').textContent = "PENDING";
      } else {
        document.getElementById('bkash-btn').textContent = "Bkash Withdraw";
        document.getElementById('nagad-btn').textContent = "Nagad Withdraw";
      }
    }
    function closeMoreWithdrawModal() {
      document.getElementById('more-withdraw-modal').style.display = 'none';
      document.getElementById('more-withdraw-form').innerHTML = '';
    }
    function showBkashForm() {
      let pending = localStorage.getItem('withdrawPending') === 'true';
      document.getElementById('more-withdraw-form').innerHTML = `
        <div style="margin-top:10px;">
          <label style="font-weight:600;">Bkash Number:</label>
          <input type="text" id="bkash-number" style="width:100%;margin:7px 0 12px 0;padding:10px;border-radius:7px;border:1.5px solid #e3e8f0;font-size:15px;" ${pending ? 'disabled' : ''}>
          <label style="font-weight:600;">Amount (USD):</label>
          <input type="number" id="bkash-amount" min="5" step="0.01" value="5" style="width:100%;margin:7px 0 12px 0;padding:10px;border-radius:7px;border:1.5px solid #e3e8f0;font-size:15px;" ${pending ? 'disabled' : ''}>
          <button id="bkash-withdraw-btn" onclick="requestBkashWithdraw()" style="width:100%;padding:10px 0;border-radius:8px;background:linear-gradient(90deg,#fa709a 0%,#fee140 100%);font-weight:700;font-size:16px;border:none;cursor:pointer;" ${pending ? 'disabled' : ''}>Request via Bkash</button>
        </div>
      `;
      if(pending) {
        document.getElementById('bkash-withdraw-btn').textContent = "PENDING";
      }
    }
    function showNagadForm() {
      let pending = localStorage.getItem('withdrawPending') === 'true';
      document.getElementById('more-withdraw-form').innerHTML = `
        <div style="margin-top:10px;">
          <label style="font-weight:600;">Nagad Number:</label>
          <input type="text" id="nagad-number" style="width:100%;margin:7px 0 12px 0;padding:10px;border-radius:7px;border:1.5px solid #e3e8f0;font-size:15px;" ${pending ? 'disabled' : ''}>
          <label style="font-weight:600;">Amount (USD):</label>
          <input type="number" id="nagad-amount" min="5" step="0.01" value="5" style="width:100%;margin:7px 0 12px 0;padding:10px;border-radius:7px;border:1.5px solid #e3e8f0;font-size:15px;" ${pending ? 'disabled' : ''}>
          <button id="nagad-withdraw-btn" onclick="requestNagadWithdraw()" style="width:100%;padding:10px 0;border-radius:8px;background:linear-gradient(90deg,#fa709a 0%,#fee140 100%);font-weight:700;font-size:16px;border:none;cursor:pointer;" ${pending ? 'disabled' : ''}>Request via Nagad</button>
        </div>
      `;
      if(pending) {
        document.getElementById('nagad-withdraw-btn').textContent = "PENDING";
      }
    }
    function requestBkashWithdraw() {
      let number = document.getElementById('bkash-number').value.trim();
      let amount = parseFloat(document.getElementById('bkash-amount').value.trim());
      if(!number || !amount) {
        alert('Please enter Bkash number and amount!');
        return;
      }
      if(amount < 5) {
        alert('Minimum withdraw is $5.00');
        return;
      }
      // Save pending state
      localStorage.setItem('withdrawPending', 'true');
      closeMoreWithdrawModal();
      showView('withdraw-view');
      alert('Bkash withdraw request sent!\nNumber: '+number+'\nAmount: $'+amount.toFixed(2));
    }
    function requestNagadWithdraw() {
      let number = document.getElementById('nagad-number').value.trim();
      let amount = parseFloat(document.getElementById('nagad-amount').value.trim());
      if(!number || !amount) {
        alert('Please enter Nagad number and amount!');
        return;
      }
      if(amount < 5) {
        alert('Minimum withdraw is $5.00');
        return;
      }
      // Save pending state
      localStorage.setItem('withdrawPending', 'true');
      closeMoreWithdrawModal();
      showView('withdraw-view');
      alert('Nagad withdraw request sent!\nNumber: '+number+'\nAmount: $'+amount.toFixed(2));
    }

    function loadHistory() {
      let historyArr = JSON.parse(localStorage.getItem('historyArr') || '[]');
      document.getElementById('history-list').innerHTML = historyArr.length ? historyArr.join('') : '<div style="color:#888;font-size:14px;">No activity yet.</div>';
    }

    function loadLeaderboard() {
      db.ref('users').orderByChild('points').limitToLast(10).once('value', function(snapshot) {
        let arr = [];
        snapshot.forEach(function(child) {
          arr.push(child.val());
        });
        arr.reverse();
        let html = '';
        arr.forEach(function(user, idx) {
          html += `
            <div class="mini-card">
              <div class="leaderboard-rank">${idx+1}</div>
              <div class="leaderboard-avatar">${user.name[0]}</div>
              <div class="leaderboard-info">
                <div class="leaderboard-name">${user.name}</div>
                <div class="leaderboard-score">${user.points || 0} pts</div>
              </div>
            </div>
          `;
        });
        document.getElementById('leaderboard-list').innerHTML = html;
      });
    }

    function loadReferrals() {
      db.ref('users/' + currentUser.id + '/referrals').once('value').then(function(snap) {
        let arr = snap.val() || [];
        if(!arr || arr.length === 0) {
          document.getElementById('referral-list').innerHTML = '<div style="color:#888;font-size:14px;">No referrals yet.</div>';
          return;
        }
        let html = '';
        let loaded = 0;
        arr.forEach(function(refId) {
          db.ref('users/' + refId).once('value').then(function(userSnap) {
            let user = userSnap.val();
            if(user) {
              html += `
                <div class="mini-card">
                  <div class="referral-avatar">${user.name[0]}</div>
                  <div class="referral-info">
                    <div class="referral-name">${user.name}</div>
                    <div class="referral-date">${user.id}</div>
                  </div>
                  <div class="referral-score">+2</div>
                </div>
              `;
            }
            loaded++;
            if(loaded === arr.length) {
              document.getElementById('referral-list').innerHTML = html;
            }
          });
        });
      });
    }

    function copyRef() {
      let ref = document.getElementById('ref-link2').textContent;
      navigator.clipboard.writeText(ref);
      alert('Referral link copied!');
    }

    function showAdModal() {
      earnPoints('ad');
      if (typeof show_9590129 === "function") {
        show_9590129({
          onReward: function() {},
          onError: function(e) {
            alert('Ad failed to load: ' + e);
          }
        });
      } else {
        alert('Ad SDK not loaded!');
      }
    }

    function closeAdModal() {
      document.getElementById('ad-modal').style.display = 'none';
      document.getElementById('monetag-ad-slot').innerHTML = '';
    }

    document.getElementById('points-value').textContent = points;
    document.getElementById('balance-value').textContent = `$${balance.toFixed(2)}`;
    document.getElementById('withdraw-balance').textContent = `$${balance.toFixed(2)}`;
    loadHistory();
    if(document.getElementById('withdraw-btn')) {
      let btn = document.getElementById('withdraw-btn');
      if(withdrawPending) {
        btn.textContent = "PENDING";
        btn.disabled = true;
      } else {
        btn.textContent = "REQUEST WITHDRAW";
        btn.disabled = false;
      }
    }
  </script>
  <script src='//libtl.com/sdk.js' data-zone='9590129' data-sdk='show_9590129'></script>
</body>
</html>